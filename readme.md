# Настройка Parcel для сборки проекта

[Документация Parcel](https://parceljs.org/getting_started.html)

## Шаг 1. Подключение Parcel и компиляция PUG-шаблонов

### Создаем папку для проекта и package.json

```
npm init -y
```

### Устанавливаем parcel глобально или локально

```
npm i -g parcel-bundler
npm i -D parcel-bundler
```

### Создаем корневой файл

Корневым будет `src/index.pug`.

Точкой входа в проект может быть любой файл, лучше всего `.html`/`.js`.

Не нужно устанавливать никаких лоадеров/обработчиков. Parcel потом сам загрузит модуль `pug`, нужный для компиляции.

### Пишем команды для запуска в package.json

```
"scripts": {
  "start": "parcel src/index.pug --open",
  "build": "parcel build src/index.pug"
},
```

Опция `--open` нужна, чтобы при запуске вкладка с проектом открывалась в браузере автоматически.

### Запускаем npm start

В папке `dist` в корне проекта появляется скомпилированный файл `index.html`.

На [localhost:1234](http://localhost:1234/) запускается живое превью.

### Проверяем функциональность PUG

Добавляем импорты, миксины, расширения и прочие плюшки.

Все работает, только почему-то страница не обновляется автоматически

### Проверяем подключение картинок

Используем изображения как обычно - подключаем в теге `img[src]`.

```
img(src="img/cat.jpg")
```

Картинка скопировалась в `dist`, добавился хеш, в финальном файле адрес обновился, но нет никаких оптимизаций.

Еще, конечно, хотелось бы помещать картинку не прямо в `dist`, а в `dist/img`, например.

## Шаг 2. Обработка JavaScript

### Подключаем JS-файл

Подключаем прямо в `index.pug`:

```
script(src="app.js")
```

В папке `dist` появилось два файла: `app.[hash].js` и app.`[hash].js.map`. Фичи ES6+ поддерживаются.

В браузере все изменения подтягиваются сразу же.

### Подключаем модули

Создаем модуль `hello` в папке `src/js/components/hello` и подключаем его в `app.js`:

```
import hello from './js/components/hello';
hello(John)
```

Работает корректно.

### Динамический импорт?

Создаем модуль `bye` в `src/js/components/bye` и подключаем его в `app.js` динамически - через `setTimeout`.

```
setTimeout(() => {
    import('./js/components/bye')
        .then(mod => mod.default)
        .then(bye => console.log(bye(John)));
}, 2000);
```

В папке `dist` появился новый скрипт + мап для него: `bye.[hash].js`, `bye.[hash].js.map`. Удобно, что сразу человекопонятное имя у чанка.

Все работает, модуль грузится и выполняется только через 2 секунды.

### Babel

Если в проекте есть конфиг Babel (добавим его), то Parcel им воспользуется.

По умолчанию код обрабатывается пресетом `@babel/preset-env`.
